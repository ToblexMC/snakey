<!doctype html>
<body>
    <title>Square</title>
    <canvas id="gameCanvas" width="900" height="900"></canvas>
    <script>
        var name = prompt("Set username");
        alert("Hello "+ name + ",welcome to square! In this game you collect other squares by using the arrow keys to move into them, you grow in size and have a limited time to eat! How much can you eat in 60 seconds? Enjoy");
        var totalYummies = prompt("Set amount of yummies (1 being hard 10 being easy")
        var canvas, canvasContext;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainloop, 1000 / 100);
        }

        //square variables
        var squaresize = 20;
        var squareXpos = 450;
        var squareYpos = 450; 
        var squareColour = "lime"

        var colour = "white"

        //press toggle
        var leftKeyPressed = false;
        var rightKeyPressed = false;
        var upKeyPressed = false;
        var downKeyPressed = false;
        var spaceKeyPressed = false;
        
        //keycodes
        const left = 37;
        const right = 39;
        const up = 38;
        const down = 40;
        const space = 32;

        //sound effects, sourced by https://gfxsounds.com/ *royalty-free*
        const eat = new Audio('/audio/eat.mp3');
        const death = new Audio('/audio/death.mp3');

        //Music, sourced by https://www.youtube.com/watch?v=-5AY7ex6pxg *copyright free*
        const music = new Audio('/audio/music.mp3');
        music.volume - .1;
        music.play();
        
        
        var speed = 3;
        var finishLoc = 1200;

        var counter = 60;
        var counterToggle = true;
        var highscore = 0;
        var highscoreLoc = 1000;
        var hsIncrease = 0;
        var highscoreText = "";
        
        var hcBestLoc = 900;

        var nameColour = "white";

        var retryToggle = 1; 
        
        var yummyToggle = true;


        var printYummy = true;

        var yummies = [];

        function mainloop() {
            colorRect(0,0,canvas.width,canvas.height,'black'); // background color
            colorRect(squareXpos,squareYpos,squaresize,squaresize,squareColour); //square
    
           
            drawText(755,20,300,100,colour, 'Countdown:' + counter); //countdown
            drawText(hcBestLoc,480,300,100,colour, highscoreText); //highscore amout
            drawText(2,20,300,100,'white', 'Size:' + squaresize); //Size Counter
            drawText(finishLoc,finishLoc,300,100,'white', 'Score: ' + squaresize); //finish
            drawText(highscoreLoc,440,300,100,'white', 'Highscore: ' + highscore); //highscore
            drawText(highscoreLoc - 40,520,300,100,'white', 'Click space bar to retry!'); //space bar
            drawText(squareXpos - 2,squareYpos - 10,300,100,nameColour, name); //Name

            console.log(totalYummies)
            move();
            yummyRandomPos();
            count();
            colourSet();
            finish();



            if(yummyToggle){
                for(i=0; i < totalYummies; i++){
                makeYummies();
                }
                yummyToggle = false;
            }

            drawYummy();

        }


        function finish(){ //what happens on counter end
            if(counter < 0.1){
                counter = 0;
                counterToggle = false;
                if(finishLoc > 401){
                death.play();
                }

                printYummy = false;
                yummyColour = "black";
                squareColour = "black";
                nameColour = "black";
                squareXpos = 800;
                finishLoc = 400;
               
                if(squaresize > highscore){
                    
                    hsIncrease = squaresize - highscore;
                    highscoreText = "You bet your highscore by " + hsIncrease + "!"
                    highscore = squaresize;
                }
                if(highscore > squaresize){
                    highscoreText = "You did not beat your highscore!";
                }

                highscoreLoc = 390;
                hcBestLoc = 320;

            }

        }


        function keyPressed(evt){ //toggle varibales of key input
            if(evt.keyCode == left){
                leftKeyPressed = true;
            }
            if(evt.keyCode == right){
                rightKeyPressed = true;
            }
            if(evt.keyCode == up){
                upKeyPressed = true;
            }
            if(evt.keyCode == down){
                downKeyPressed = true;
            }
            if(evt.keyCode == space){
                spaceKeyPressed = true;
            }
        }

        function move(){ //what dto dso on key inuiput
            if(leftKeyPressed == true && squareXpos > 0 && counter > 0){
                squareXpos = squareXpos - speed;
            }
            if(rightKeyPressed == true && squareXpos < canvas.width - squaresize && counter > 0){
                squareXpos = squareXpos + speed;
            }
            if(upKeyPressed == true && squareYpos > 0 && counter > 0){
                squareYpos = squareYpos - speed;
            }
            if(downKeyPressed == true && squareYpos < canvas.height - squaresize && counter > 0){
                squareYpos = squareYpos + speed;
            }
            if(spaceKeyPressed == true){
                
                squaresize = 20; 
                squareXpos = 450;
                squareYpos = 450; 
                printYummy = true;
                yummyColour = "red";
                squareColour = "lime";
                nameColour = "white";
                counterToggle = true;


             colour = "white";

             finishLoc = 1200;

             counter = 60;

        highscoreLoc = 1000;
        hsIncrease = squaresize - highscore;
        hcBestLoc = 1000;

        yummyXpos = 120;
        yummyYpos = 300;
            }
        }

        function keyReleased(evt) { //toggle off on release key
            if(evt.keyCode == left){
                leftKeyPressed = false;
            }
            if(evt.keyCode == right){
                rightKeyPressed = false;
            }
            if(evt.keyCode == up){
                upKeyPressed = false;
            }
            if(evt.keyCode == down){
                downKeyPressed = false;
            }
            if (evt.keyCode == space){
                spaceKeyPressed = false;
                retryToggle = false; 
            }
        }

        function yummyRandomPos(){ //yummys reandom posiotion
            yummies.forEach(function(yummy){

            
            if(yummy.yummyYpos + squaresize > squareYpos && yummy.yummyYpos < squareYpos + squaresize && yummy.yummyXpos + yummy.yummySize > squareXpos && yummy.yummyXpos < squareXpos + squaresize){
                yummy.yummyXpos = Math.floor(Math.random()*(900 - yummy.yummySize));
                yummy.yummyYpos = Math.floor(Math.random()*(900 - yummy.yummySize));
                squaresize = squaresize + 2;
                speed = speed + .1; 
                eat.play();

            }
        });
        }

        function count(){ //counytdown
            if(counter > 0 && counterToggle){
            counter = counter - 0.01;
            }
            if(counter < 0){
                counter = 0
            }
            
        }

        function colourSet(){ //set colkour of countdown as it gets to 0
            if(counter < 31 && counter > 21){
                colour = "yellow";
            }

            if(counter < 21 && counter > 11){
                colour = "orange";
            }

            if (counter < 11){
                colour = "red"
            }
        }


        function colorRect(x,y,w,h,c){
            canvasContext.fillStyle = c;5409+94*9+5*8-20388-5878490
            canvasContext.fillRect(x,y,w,h);
        }

        function drawText(x,y,w,h,color, msg){
            canvasContext.fillStyle = color;
            canvasContext.fillText(msg,x,y,w,h);
            canvasContext.font = "20px Arial";
        }




        function makeYummies(){ //makes arrays of yummies
            var yummySize = 35
            var yummyXpos = Math.floor(Math.random()*(900 - yummySize));
            var yummyYpos = Math.floor(Math.random()*(900 - yummySize));
            var yummyColour = "red";

            var yummy = {
                yummySize: yummySize,
                yummyXpos: yummyXpos,
                yummyYpos: yummyYpos,
                yummyColour: yummyColour
            }

            yummies.push(yummy)
        }

        function drawYummy(){ //drawsa arrays
            if(printYummy){ //so if game over it will not show any
            yummies.forEach(function(yummy, i){
                colorRect(yummy.yummyXpos,yummy.yummyYpos,yummy.yummySize,yummy.yummySize,yummy.yummyColour); //yummy
            });
            
            
        }else{
            yummyColour = "black";
        }
        }

    </script>
</body>